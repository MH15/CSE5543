import{T as e}from"./vendor.22bf0665.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();function t(e,t){let n=e.makeCircle(t.x,t.y,5);return n.fill="rgb(224, 151, 4)",n.linewidth=0,{circle:n,anchor:t}}function n(t,n,l){t.visible=!0,t.translation=new e.Vector(n.x,n.y-15),t.value=`Point ${l}\n(${o(n.x/window.innerWidth)}, ${o(n.y/window.innerHeight)})`}const o=e=>Math.round(1e4*e)/1e4;function l(e){let t=e.split(/\r\n|\r|\n/),n=0;if("BEZIER"!=t[n])throw new Error("File must begin with 'BEZIER'");for(;t[n].startsWith("#");)n++;n++;let[o,l,i]=function(e){let t=e.split(" "),n=parseInt(t[0]),o=parseInt(t[1]),l=parseInt(t[2]);return[n,o,l]}(t[n]);n++;let r=[];for(;n<t.length;){let e=t[n].split(" "),o=parseFloat(e[0])*window.innerWidth,l=parseFloat(e[1])*window.innerHeight;r.push([o,l]),n++}let s=(l-1)/i;if(Math.round(s)!==s)throw new Error("degree does not match");return{points:r,degree:i}}function i(e,t){return e.findIndex((e=>e.anchor.equals(t.anchor)))}function r(t,n){return t.map((t=>{let o=t.map((e=>[e.x,e.y]));var l,i=(l=o,function(e){const t=l.length;let n=new Array(t);for(let o=0;o<t;o++)n[o]=new Array(t),n[0][o]=l[o];for(let o=1;o<t;o++)for(let l=0;l<t-o;l++){let t=n[o-1][l],i=n[o-1][l+1];n[o][l]=s(e,t,i)}return n[t-1][0]});let r=n*t.length,c=[];for(var d=0;d<=r;d++){let t=i(d/r),n=new e.Anchor(t[0],t[1]);c.push(n)}return c})).flat()}function s(e,t,n){let o=[0,0];for(let l=0;l<t.length;l++)o[l]=t[l]*(1-e)+n[l]*e;return o}function c(e,n,o,l){let i=function(e){let t=[];for(const n of e){let e=n.map((e=>[e.x,e.y]));const o=e.length,l=.5;let i=new Array(o);for(let t=0;t<o;t++)i[t]=new Array(o),i[0][t]=e[t];for(let t=1;t<o;t++)for(let e=0;e<o-t;e++){let n=i[t-1][e],o=i[t-1][e+1];i[t][e]=s(l,n,o)}let r=[];for(let t=0;t<o;t++)r[t]=i[t][0];t.push(r),r=[];for(let t=0;t<o;t++)r[t]=i[o-t-1][t];t.push(r)}return t}(e.points);e.handles.forEach((e=>{o.remove(e.circle)})),e.points=[];for(const t of i){let o=t.map((e=>new n.Anchor(e[0],e[1])));e.points.push(o)}for(let t=1;t<e.points.length;t++){let n=e.points[t],o=e.points[t-1];n[0]=o[o.length-1]}e.handles=[];for(let r=0;r<e.points.length;r++)for(let n=0;n<e.points[r].length;n++)r>0&&0==n||e.handles.push(t(o,e.points[r][n]));e.guides.vertices=e.points.flat(),e.pointsOnCurves=r(e.points,l)}const d=document.getElementById("canvas");let u=new e({width:window.innerWidth,height:window.innerHeight,type:e.Types.svg}).appendTo(d);const a=document.querySelector("#start"),p=document.querySelector("#start-file"),h=document.querySelector("#start-number"),f=document.querySelector("#start-menu"),g=document.querySelector("#filename"),m=document.querySelector("#save"),w=document.querySelector("#resolution"),v=document.querySelector("#show-guides"),y=document.querySelector("#resolution-count"),b=document.querySelector("#subdivide"),E=document.querySelector("#stats"),x=()=>parseInt(w.value);let L=[[]],q={dragging:!1,selected:null,tooltip:new e.Text("_",100,100),handles:L.flat().map((e=>t(u,e))),points:L,pointsOnCurves:null,guides:new e.Path(L.flat()),maxPoints:null};q.tooltip.visible=!1,u.add(q.tooltip),q.guides.noFill(),u.add(q.guides),b.addEventListener("click",(()=>c(q,e,u,x()))),a.addEventListener("click",(async n=>{let o=h.value,i=p.files[0];if(i){!function(n){let{points:o,degree:i}=l(n);q.points=[];let s=[],c=0;for(;c<o.length-i;)s.push(o.slice(c,c+i+1)),c+=i;console.log(q.points),q.handles.forEach((e=>{u.remove(e.circle)})),q.points=[];for(const t of s){let n=t.map((t=>new e.Anchor(t[0],t[1])));q.points.push(n)}for(let e=1;e<q.points.length;e++){let t=q.points[e],n=q.points[e-1];t[0]=n[n.length-1]}q.handles=[];for(let e=0;e<q.points.length;e++)for(let n=0;n<q.points[e].length;n++)e>0&&0==n||q.handles.push(t(u,q.points[e][n]));q.guides.vertices=q.points.flat(),q.pointsOnCurves=r(q.points,x())}(await function(e){return new Promise(((t,n)=>{const o=new FileReader;o.onload=e=>{t(e.target.result.toString())},o.onerror=e=>n(e),o.readAsText(e)}))}(i)),f.style.visibility="hidden"}else if(o.length>0){!function(e){console.log("let the user draw"),q.points=[[]],q.handles=[],q.maxPoints=e}(parseInt(o)),f.style.visibility="hidden"}else alert("Please fill out one of the input fields.")})),m.addEventListener("click",(e=>{let t=g.value;0===t.length&&(t="bezier.txt");let n="BEZIER\n",l=q.handles.length;console.log(q),n+=`2 ${l} ${(l-1)/q.points.length}`;for(const i of q.handles)n+="\n"+o(i.anchor.x/window.innerWidth)+" "+o(i.anchor.y/window.innerHeight);!function(e,t){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(t,n)}));let S=new e.Path(q.pointsOnCurves);S.linewidth=2,S.noFill(),u.add(S),null==d||d.addEventListener("mousedown",(t=>function(e,t,o){t.dragging=!0;let l=e.clientX,r=e.clientY,s=new o.Vector(l,r);t.selected=function(e,t,n){let o=null,l=35;for(const i of e){let e=i.circle.translation.distanceTo(t);e<l&&(l=e,o=i)}return o}(t.handles,s);for(const n of t.handles)n.circle.fill="rgb(224, 151, 4)";null!=t.selected?(t.selected.circle.fill="rgb(94, 148, 235)",n(t.tooltip,t.selected.circle.translation,i(t.handles,t.selected))):t.tooltip.visible=!1}(t,q,e))),null==d||d.addEventListener("mouseup",(e=>{q.dragging=!1})),null==d||d.addEventListener("mousemove",(t=>function(e,t,o){if(t.dragging){let l=e.clientX,r=e.clientY,s=new o.Vector(l,r);null!=t.selected&&(t.selected.circle.translation=s,t.selected.anchor.x=s.x,t.selected.anchor.y=s.y,n(t.tooltip,t.selected.circle.translation,i(t.handles,t.selected)))}}(t,q,e))),null==d||d.addEventListener("click",(n=>function(e,n,o,l){if(e.preventDefault(),n.points[0].length<n.maxPoints){let i=e.clientX,r=e.clientY,s=new o.Vector(i,r);n.points[n.points.length-1].push(s);let c=t(l,s);n.guides.vertices.push(c.anchor),n.handles.push(c)}return console.log(n),!1}(n,q,e,u))),u.bind("update",(function(e){var t;q.points[0].length>0&&(q.pointsOnCurves=r(q.points,x()),S.vertices=q.pointsOnCurves,q.guides.visible=v.checked),y.innerHTML=`${x()}`,E.innerHTML=`Points: ${q.points.flat().length}, Curves: ${q.points.length} Degree: ${q.points[0].length-1}, Lines: ${null==(t=q.pointsOnCurves)?void 0:t.length}`})).play();
